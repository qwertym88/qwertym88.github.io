<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="关于cubism3模型点击区域的绑定"><meta name="keywords" content="live2d"><meta name="author" content="石海鹏,undefined"><meta name="copyright" content="石海鹏"><title>关于cubism3模型点击区域的绑定 | 石海鹏的网页</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?135fb72c1ba680bd194f7e2d3949657d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于点击区域的解释"><span class="toc-number">2.</span> <span class="toc-text">关于点击区域的解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于点击区域的位置"><span class="toc-number">3.</span> <span class="toc-text">关于点击区域的位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">4.</span> <span class="toc-text">后记</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://ws1.sinaimg.cn/thumbnail/0072Lfvtly1fz3tcisykvj30nb0nb0z8.jpg"></div><div class="author-info__name text-center">石海鹏</div><div class="author-info__description text-center">编程辅导&amp;交流</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">5</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">4</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">2</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://github.com/shihaipeng" target="_blank">github</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ws1.sinaimg.cn/large/8700af19ly1fvpabr30o6j22yo1o0q7i.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">石海鹏的网页</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">关于cubism3模型点击区域的绑定</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-26</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/笔记/">笔记</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>首先感谢<a href="https://himehane.club/live2d_on_website/" target="_blank" rel="noopener">himehane</a>的帮助</strong><br>在看了他的文章后，有了把碧蓝航线的模型放到网页上的想法。正好此前有<a href="https://github.com/Perfare/AzurLaneLive2DExtract" target="_blank" rel="noopener">perfare</a>的项目提取live2d模型，剩下的就是如何使用了。<br><a id="more"></a><br>由于碧蓝航线的live2d是cubism3的，而且这方面的样例实在不多，所以我抱着瞎猫碰死耗子的心态试了一下官方的sdk。尝试许久，却总是在加载模型动作时报错（如下），多次尝试并不能找到报错的原因，同一个动作不同时候也会报不同的错（随机的？），模型确实是没问题的，但为什么不行不知道。最终我选择放弃。<br><img src="/2019/08/26/关于cubism3模型点击区域的绑定/1.png"></p>
<p>然后我想看看有没有转换的方法，找到了<a href="https://imjad.cn/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-03" target="_blank" rel="noopener">imjad</a>的博客，但是发现还是行不通。如果有工程文件(.canx?)时可以用，但我们提取到的是执行文件(.moc),而且好像也没有转回去的方法，所以也行不通。</p>
<p>最终在找到himehane的文章后，打算上手。但个人有强迫症，觉得点击区域绑定一朝做不好，模型就欠缺灵魂。最终在与官方sdk的两相对比后，有了下文</p>
<h2 id="关于点击区域的解释"><a href="#关于点击区域的解释" class="headerlink" title="关于点击区域的解释"></a>关于点击区域的解释</h2><p>参见<a href="http://live2d.pavostudio.com/doc/zh-cn/live2d/model-config-sdk3/#hitareas" target="_blank" rel="noopener">这个</a>解释（虽然并不是官方的，但很可以做参考），我们最先需要的就是知道区域ID指的是什么。（以下省略漫长的寻找过程）最终我们打开cubismviewer3(ow)，在.moc文件的artmesh下找到了我们要找的内容。<br><img src="/2019/08/26/关于cubism3模型点击区域的绑定/2.png"></p>
<p>再来寻找代码中的在哪。（以下省略同样漫长的寻找过程），最终在 _coremodel.drawables下找到了。<br><img src="/2019/08/26/关于cubism3模型点击区域的绑定/3.png"><br>所以我的模型的model3.json长成了这样<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"Version"</span>: <span class="number">3</span>,</span><br><span class="line">	<span class="attr">"FileReferences"</span>: &#123;</span><br><span class="line">		<span class="attr">"Moc"</span>: <span class="string">"lafei_4.moc3"</span>,</span><br><span class="line">		<span class="attr">"Textures"</span>: [</span><br><span class="line">			<span class="string">"textures/texture_00.png"</span></span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"Physics"</span>: <span class="string">"lafei_4.physics3.json"</span>,</span><br><span class="line">		<span class="attr">"Motions"</span>: &#123;</span><br><span class="line">			<span class="attr">"Touch"</span>: [</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/main_1.motion3.json"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/mission_complete.motion3.json"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/complete.motion3.json"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/mission.motion3.json"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/main_2.motion3.json"</span></span><br><span class="line">				&#125;</span><br><span class="line">			],</span><br><span class="line">			<span class="attr">"TouchHead"</span>: [</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/touch_head.motion3.json"</span></span><br><span class="line">				&#125;</span><br><span class="line">			],</span><br><span class="line">			<span class="attr">"Idle"</span>: [</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/idle.motion3.json"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/main_3.motion3.json"</span></span><br><span class="line">				&#125;</span><br><span class="line">			],</span><br><span class="line">			<span class="attr">"TouchSpecial"</span>: [</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"File"</span>: <span class="string">"motions/touch_special.motion3.json"</span></span><br><span class="line">				&#125;</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"Groups"</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">"Target"</span>: <span class="string">"Parameter"</span>,</span><br><span class="line">			<span class="attr">"Name"</span>: <span class="string">"LipSync"</span>,</span><br><span class="line">			<span class="attr">"Ids"</span>: [</span><br><span class="line">				<span class="string">"ParamMouthOpenY"</span></span><br><span class="line">			]</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">"Target"</span>: <span class="string">"Parameter"</span>,</span><br><span class="line">			<span class="attr">"Name"</span>: <span class="string">"EyeBlink"</span>,</span><br><span class="line">			<span class="attr">"Ids"</span>: [</span><br><span class="line">				<span class="string">"ParamEyeLOpen"</span>,</span><br><span class="line">				<span class="string">"ParamEyeROpen"</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">"HitAreas"</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">"Name"</span>: <span class="string">"Touch"</span>,</span><br><span class="line">			<span class="attr">"Id"</span>: <span class="string">"TouchBody"</span>,</span><br><span class="line">			<span class="attr">"Order"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="attr">"MotionGroup"</span>: <span class="string">"Touch"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">"Name"</span>: <span class="string">"TouchSpecial"</span>,</span><br><span class="line">			<span class="attr">"Id"</span>: <span class="string">"TouchSpecial"</span>,</span><br><span class="line">			<span class="attr">"Order"</span>: <span class="number">100</span>,</span><br><span class="line">			<span class="attr">"MotionGroup"</span>: <span class="string">"TouchSpecial"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">"Name"</span>: <span class="string">"TouchHead"</span>,</span><br><span class="line">			<span class="attr">"Id"</span>: <span class="string">"TouchHead"</span>,</span><br><span class="line">			<span class="attr">"Order"</span>: <span class="number">10</span>,</span><br><span class="line">			<span class="attr">"MotionGroup"</span>: <span class="string">"TouchHead"</span></span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注：关于HitAreas中MotionGroup一项，是我的程序用的，不用太在意了。</p>
<h2 id="关于点击区域的位置"><a href="#关于点击区域的位置" class="headerlink" title="关于点击区域的位置"></a>关于点击区域的位置</h2><p>反复对比官方sdk，经过超级长时间的研究后（如果你想，可以试试，突破口应该是framework/model/cubismusermodel.ts）,发现代码如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">public isHit(drawableId: CubismIdHandle, <span class="attr">pointX</span>: number, <span class="attr">pointY</span>: number): boolean</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">const</span> drawIndex: number = <span class="keyword">this</span>._model.getDrawableIndex(drawableId);</span><br><span class="line">           <span class="keyword">if</span>(drawIndex &lt; <span class="number">0</span>)</span><br><span class="line">           &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 存在しない場合はfalse</span></span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">const</span> count: number = <span class="keyword">this</span>._model.getDrawableVertexCount(drawIndex);</span><br><span class="line">           <span class="keyword">const</span> vertices: <span class="built_in">Float32Array</span> = <span class="keyword">this</span>._model.getDrawableVertices(drawIndex);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">let</span> left: number = vertices[<span class="number">0</span>];</span><br><span class="line">           <span class="keyword">let</span> right: number = vertices[<span class="number">0</span>];</span><br><span class="line">           <span class="keyword">let</span> top: number = vertices[<span class="number">1</span>];</span><br><span class="line">           <span class="keyword">let</span> bottom: number = vertices[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">let</span> j: number = <span class="number">1</span>; j &lt; count; ++j)</span><br><span class="line">           &#123;</span><br><span class="line">               <span class="keyword">let</span> x = vertices[Constant.vertexOffset + j * Constant.vertexStep];</span><br><span class="line">               <span class="keyword">let</span> y = vertices[Constant.vertexOffset + j * Constant.vertexStep + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span>(x &lt; left)</span><br><span class="line">               &#123;</span><br><span class="line">                   left = x; <span class="comment">// Min x</span></span><br><span class="line">               &#125;</span><br><span class="line">               </span><br><span class="line">               <span class="keyword">if</span>(x &gt; right)</span><br><span class="line">               &#123;</span><br><span class="line">                   right = x; <span class="comment">// Max x</span></span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span>(y &lt; top)</span><br><span class="line">               &#123;</span><br><span class="line">                   top = y; <span class="comment">// Min y</span></span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span>(y &gt; bottom)</span><br><span class="line">               &#123;</span><br><span class="line">                   bottom = y; <span class="comment">// Max y</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">const</span> tx: number = <span class="keyword">this</span>._modelMatrix.invertTransformX(pointX);</span><br><span class="line">           <span class="keyword">const</span> ty: number = <span class="keyword">this</span>._modelMatrix.invertTransformY(pointY);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> ((left &lt;= tx) &amp;&amp; (tx &lt;= right) &amp;&amp; (top &lt;= ty) &amp;&amp; (ty &lt;= bottom));</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></p>
<p>Constant.vertexOffset=0，Constant.vertexStep=2应该对于所有模型都是适用的<br>this._model.getDrawableIndex()返回的就是 _coremodel.drawables.ids.indexOf()的值，做出类似替换得到代码如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//function(id)&#123;//id-&gt;区域id</span></span><br><span class="line">	<span class="keyword">let</span> d=<span class="keyword">this</span>._model.drawables;</span><br><span class="line">    <span class="keyword">let</span> index=d.ids.indexOf(id);</span><br><span class="line">    <span class="keyword">let</span> count=d.vertexCounts[index];</span><br><span class="line">    <span class="keyword">let</span> vertices=d.vertexPositions[index];<span class="comment">//相对位移</span></span><br><span class="line">    <span class="keyword">let</span> left = vertices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> right = vertices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> top = vertices[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> bottom = vertices[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">1</span>; j &lt; count; ++j)&#123;</span><br><span class="line">        <span class="keyword">let</span> x = vertices[<span class="number">0</span> + j * <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">let</span> y = vertices[<span class="number">0</span> + j * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(x &lt; left)&#123;left = x;&#125;<span class="comment">// 最左边的点相对中点x轴位移     </span></span><br><span class="line">        <span class="keyword">if</span>(x &gt; right)&#123;right = x;&#125;<span class="comment">// Max x</span></span><br><span class="line">        <span class="keyword">if</span>(y &gt; top)&#123;top = y;&#125;<span class="comment">// 最上边的点相对中点x轴位移</span></span><br><span class="line">        <span class="keyword">if</span>(y &lt; bottom)&#123;bottom = y;&#125;<span class="comment">// Max y</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>关于vertexCounts返回的是这个东西的顶点个数，而下面的for循环就是遍历出上下左右四个定位点。vertexPositions是<strong>顶点相对模型中点的位移</strong>（省略无数发现它的过程），<strong>计算原理是：（中点横/纵坐标-点的横/纵坐标）/放大倍数</strong>（可参见官方framework/math/cubismmatrix44.ts的146到160行，逆推而得）。</p>
<p>所以得到各个定位点坐标如下<br><strong>坐标=模型中点坐标+相对位移*放大倍数（y为减）</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">left=left*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_x;</span><br><span class="line">   right=right*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_x;</span><br><span class="line">   top=-top*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_y;<span class="comment">//万分注意它上下是反的，所以是减去</span></span><br><span class="line">   bottom=-bottom*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_y;</span><br></pre></td></tr></table></figure></p>
<p>关于为什么y轴方向的是减法没考虑过，反正能用就行了<br>最后汇总一下，得到最终的代码，如我个人的代码就是<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//id-&gt;点击区域id（artmesh的id），pointX/Y -&gt; pageX/Y</span></span><br><span class="line"><span class="comment">//计算原理：遍历点的上下左右范围，判定点坐标x=模型中点坐标+相对位移*放大倍数（y为减）</span></span><br><span class="line">MotionHandler.prototype.isHit = <span class="function"><span class="keyword">function</span>(<span class="params">id,pointX,pointY</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> d=<span class="keyword">this</span>._model.drawables;</span><br><span class="line">    <span class="keyword">let</span> index=d.ids.indexOf(id);</span><br><span class="line">    <span class="keyword">let</span> count=d.vertexCounts[index];</span><br><span class="line">    <span class="keyword">let</span> vertices=d.vertexPositions[index];<span class="comment">//相对位移</span></span><br><span class="line">    <span class="keyword">let</span> left = vertices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> right = vertices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> top = vertices[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> bottom = vertices[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">1</span>; j &lt; count; ++j)&#123;</span><br><span class="line">        <span class="keyword">let</span> x = vertices[<span class="number">0</span> + j * <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">let</span> y = vertices[<span class="number">0</span> + j * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(x &lt; left)&#123;left = x;&#125;   </span><br><span class="line">        <span class="keyword">if</span>(x &gt; right)&#123;right = x;&#125;</span><br><span class="line">        <span class="keyword">if</span>(y &gt; top)&#123;top = y;&#125;</span><br><span class="line">        <span class="keyword">if</span>(y &lt; bottom)&#123;bottom = y;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    left=left*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_x;</span><br><span class="line">    right=right*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_x;</span><br><span class="line">    top=-top*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_y;</span><br><span class="line">    bottom=-bottom*<span class="keyword">this</span>._scale+<span class="keyword">this</span>._center_y;</span><br><span class="line">    <span class="keyword">return</span> ((left &lt;= pointX) &amp;&amp; (pointX &lt;= right) &amp;&amp; (bottom &gt;= pointY) &amp;&amp; (pointY &gt;= top));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>事实上这个对于所有的区域应该都是可以的，比如如果我想把右耳作为一个点击区域，首先找到artmesh的id，然后改一下model3.json。最后注意一下可执行的区域应该是一个矩形（蓝色方框），所以建议定义一个优先度的东西，以便优先判断小块的点击区域<br><img src="/2019/08/26/关于cubism3模型点击区域的绑定/4.png"></p>
<p>顺便推销一下<a href="https://github.com/shihaipeng/live2d-cubism3-helper" target="_blank" rel="noopener">我的代码</a>（再次感谢<a href="https://himehane.club/live2d_on_website/" target="_blank" rel="noopener">himehane</a>，事实上很多都是抄袭他的，无比惭愧），当然，昨天（8/25号）才算是基本可以看了。有些细节如呼吸，眨眼加了上去，改进了一下鼠标事件，用成了相对网页的位移，当然还有点击区域的绑定。<br>马上开学了（&lt;=4天），该死的学校星期天强制补课，所以我几乎不怎么可能在下一个学期动我的代码了，随缘更新改bug。如想勾搭QQ欢迎（2112966311）</p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/live2d/">live2d</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/23/绘画/"><i class="fa fa-chevron-left">  </i><span>绘画</span></a></div><div class="next-post pull-right"><a href="/2018/11/10/c-函数（2）/"><span>c++函数（2）</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="lv-container" data-id="city" data-uid="MTAyMC80MjExNS8xODY2Mg=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By 石海鹏</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">随便写的，不要在意....</div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script><script src="/js/search/local-search.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>